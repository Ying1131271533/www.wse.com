{extend name="layout/base" /}
{block name="title"}会员登录{/block}
{block name="load"}
<!-- css -->
<link rel="stylesheet" href="__FRONT__/css/style4.css">
<style>
    @-moz-keyframes nodeInserted {
        from {
            opacity: 0.99;
        }

        to {
            opacity: 1;
        }
    }

    @-webkit-keyframes nodeInserted {
        from {
            opacity: 0.99;
        }

        to {
            opacity: 1;
        }
    }

    @-o-keyframes nodeInserted {
        from {
            opacity: 0.99;
        }

        to {
            opacity: 1;
        }
    }

    @keyframes nodeInserted {
        from {
            opacity: 0.99;
        }

        to {
            opacity: 1;
        }
    }

    embed,
    object {
        animation-duration: .001s;
        -ms-animation-duration: .001s;
        -moz-animation-duration: .001s;
        -webkit-animation-duration: .001s;
        -o-animation-duration: .001s;
        animation-name: nodeInserted;
        -ms-animation-name: nodeInserted;
        -moz-animation-name: nodeInserted;
        -webkit-animation-name: nodeInserted;
        -o-animation-name: nodeInserted;
    }
</style>
<!-- js -->
{/block}
<!-- 主体内容 -->
{block name="main"}

<!-- 中间内容开始 -->

<!-- 头部 结束 -->
<div class="l_c_bar">
  <div class="l_c_center">
    <div style="float:left;">
      <a href="/">
        <img src="__FRONT__/images/hl.png" style="width:auto;max-width:90px;height:55px;"
        onerror="this.src='newpage/images/hl.png'">
      </a>
    </div>
    <div class="l_t">
      <strong>威速易供应链管理-会员登录</strong>
    </div>
    <div class="clear"></div>
  </div>
</div>
<div class="l_c_center">
  <div class="l_content">
    <!-- banner 开始 -->
    <div id="full-screen-slider">
      <ul id="slides">
        <li><img alt="" src="__FRONT__/images/lg_bj.png" width="520px" height="400px">
        </li>
      </ul>
    </div>
    <!-- banner 开始 -->

    <!-- 登录内容 开始 -->
    <form method="post" action="">
      <div class="form_main_box">
        <div class="form_main">
          <div class="f_l_title">登录</div>
          <ul class="f_l_cont">
            <li>
              <div class="int_ui">
                <input class="int-user" id="username" type="text" name="username" value="" placeholder="请输入用户名">
              </div>
            </li>
            <li>
              <div class="int_ui">
                <input class="int-pwd" id="password" type="password" name="password" placeholder="请输入密码">
              </div>
            </li>
            <li>
              <div class="clear"></div>
              <span style="color:red;"></span>
            </li>
          </ul>
          <input type="submit" class="l_btn" value="登 录">
          <div class="l_f_reg"> 还没有帐号？<a href="/register">免费注册 &gt;</a></div>

        </div>
      </div>
    </form>
    <!-- 登录内容 结束 -->
  </div>
</div>
<script type="text/javascript" charset="utf-8">

  // 获取token
  let token = getToken();

  layui.config({
    base: '/static/common/lib/dist/sliderVerify/'
  }).use(['sliderVerify', 'jquery', 'form'], function () {

    // 滑块验证
    var sliderVerify = layui.sliderVerify,
      $ = layui.jquery,
      form = layui.form;
    var slider = sliderVerify.render({
      elem: '#slider',
      onOk: function () { // 当验证通过回调
        // layer.msg("滑块验证通过");
      }
    })

    // 是否已登录过
    if (!empty(token)) {
        layer.msg('已登录，无需重复登录', { time: 700 }, function () {
            $(window).attr('location', '/view/index');
        });
    }
    
    //监听提交
    form.on('submit(login)', function (data) {
      if (slider.isOk()) {
        // 发异步，把数据提交给php
        $.ajax({
          type: "POST",
          contentType: "application/x-www-form-urlencoded",
          url: '/login',
          data: {
            username: data.field.username,
            password: data.field.password
          },
          success: function (res) {
            console.log(res);
            if (res.code === config('failed')) {
              layer.msg(res.msg);
            } else if (res.code === config('success')) {
              $.cookie('admin_login_token', res.data.token, { expires: 100 * 365, path: '/' });
              $(window).attr('location', '/view/index');

              // 下面这提示有点烦~~~
              // layer.msg('登录成功！', {time: 500}, function () {
              //   $.cookie('admin_login_token', res.data.token, { expires: 100 * 365, path: '/' });
              //   $(window).attr('location', '/view/index');
              // });
            }
          }
        });

      } else {
        layer.msg("请先通过滑块验证");
      }
      return false;
    });

  })
</script>

<!--中间内容 结束-->
{/block}